---

copyright:
  years: 2015, 2016, 2017
lastupdated: "2017-03-01"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}


# Connecting gateways
{: #IoT_connectGateway}

Before you can begin receiving data from devices that are connected to your gateways, you must connect the gateway to  {{site.data.keyword.iot_full}}. Connecting a gateway to {{site.data.keyword.iot_short_notm}} involves creating a gateway device type and registering the gateway with {{site.data.keyword.iot_short_notm}}. You can then use the registration information to connect the gateway to {{site.data.keyword.iot_short_notm}}.
{:shortdesc}

Gateways are a specialized class of devices in {{site.data.keyword.iot_short_notm}}. Gateways serve as access points to the {{site.data.keyword.iot_short_notm}} for other devices.


## Before you begin
{: #Prerequisites}

Gateway devices have additional permissions when compared to regular devices and can perform the following  functions:
- Register new devices to {{site.data.keyword.iot_short_notm}}
- Send and receive its own sensor data like a directly connected device,
- Send and receive data on behalf of the devices connected to it
- Run a device management agent, so that it can be managed, also manage the devices connected to it.  
For gateway developer information, see [MQTT connectivity for gateways](mqtt.html).

You can also use gateways to perform edge analytics on the data that the gateway devices are sending. For more information, see [Edge analytics](../edge_analytics.html) and [Installing the edge analytics agent](#edge).

## Step 1: Registering your gateway with {{site.data.keyword.iot_short_notm}}  
{: #register_gateway}

Registering a gateway involves classifying the device as a gateway type, giving the gateway a name, and providing gateway information. Then you provide a connection token or accept a token that is generated by {{site.data.keyword.iot_short_notm}}.

**Tip:** You can add gateways one at a time from the {{site.data.keyword.iot_short_notm}} dashboard, or you can use the [{{site.data.keyword.iot_short_notm}} API ![External link icon](../../../icons/launch-glyph.svg)](https://docs.internetofthings.ibmcloud.com/swagger/v0002.html#!/Bulk_Operations/post_bulk_devices_add){:new_window} to add one or more gateways at a time.

To add a gateway from the {{site.data.keyword.iot_short_notm}} dashboard:

1. In the {{site.data.keyword.iot_short_notm}} dashboard, select **Devices**.
2. Click **Add Device**.
3. Select or create a device type for the device that you are adding.  
Each device that is connected to the {{site.data.keyword.iot_short_notm}} must be associated with a device type. Device types are groups of devices that share common characteristics.  
 1. Click **Create device type** then **Create gateway type**.
 2. Enter a device type name such as `my_gateway_type` and a description for the gateway type.   
 **Important:** The device type name must be no more than 36 characters and can contain only:
 <ul>
  <li>Alpha-numeric characters (a-z, A-Z, 0-9)</li>
  <li>Hypens (-)</li>
  <li>Underscores (&lowbar;)</li>
  <li>Periods (.)</li>
  </ul>3. Optional: Enter gateway type attributes and metadata.    
 **Tip:** You can add and edit attributes and metadata later.
 4. Click **Create** to add the new gateway type.
10. Click **Next** to begin the process of adding your gateway device with the selected gateway type.
11. Enter a device ID such as `my_gateway_device`.  
The device ID is used to identify the gateway device in the {{site.data.keyword.iot_short_notm}} dashboard and is also a required parameter for connecting your gateway device to {{site.data.keyword.iot_short_notm}}.  
**Important:** The device ID must be no more than 36 characters and can contain only:
 <ul>
 <li>Alpha-numeric characters (a-z, A-Z, 0-9)</li>
 <li>Hyphens (-)</li>
 <li>Underscores (&lowbar;)</li>
 <li>Periods (.)</li>  
 </ul>
 **Tip:** For network connected devices, the device ID could for example be the device MAC address without any separating colons.  
12. Optional: Click **Additional fields** to add gateway device information, such as serial number, manufacturer, model, and so on.  
 **Tip:** You can add and edit this information later.
12. Optional: Enter device JSON metadata.  
 **Tip:** You can add and edit device metadata later.
13. Click **Next** to complete the addition of your gateway device.
14. Verify that the summary information is correct and then click **Add** to add the gateway device.  
**Tip:** You have the option to accept an automatically generated authentication token or to provide an authentication token yourself. If you choose to create your own token, make sure that it is between 8 and 36 characters long, contains a mix of lower and upper case letters, numbers, and hyphen, underscore, or period. The token must not contain repeated character sequences, dictionary words, user names, or other predefined sequences.
15. In the device information page, copy and save the following device information:  
 - Organization ID, such as `tubo8x`
 - Device Type, such as `my_gateway_type`
 - Device ID. **Tip:** For network connected devices, this could for example be the MAC address without any separating colons.
 - Authentication Method, such as `token`
 - Authentication Token, such as `PtBVriRqIg4uh)_-Kl`  
  **Tip:** You will need Organization ID, Authentication Token, Device Type, and Device ID to configure your device to connect to {{site.data.keyword.iot_short_notm}}.  

Congratulations, you registered your gateway device. Now you can configure your gateway device to connect to {{site.data.keyword.iot_short_notm}}

Refer to the [How to Register Gateways in IBM Watson IoT Platform ![External link icon](../../../icons/launch-glyph.svg)](https://developer.ibm.com/recipes/tutorials/how-to-register-gateways-in-ibm-watson-iot-platform/){:new_window} recipe for step-by-step instructions that demonstrate the flow that is required to register a gateway.

## Step 2: Connecting your gateway to {{site.data.keyword.iot_short_notm}}
{: #connect_gateway}

After you register a gateway with {{site.data.keyword.iot_short_notm}} use the registration information to connect the gateway to {{site.data.keyword.iot_short_notm}} and start receiving data from devices that are connected to the gateway.

For information about connecting your gateway to {{site.data.keyword.iot_short_notm}}, see [MQTT connectivity for gateways](mqtt.html).

**Tip:** There are a range of recipes available for connecting devices to {{site.data.keyword.iot_short_notm}}. For a list of recipes, see the
[Device connection recipes ![External link icon](../../../icons/launch-glyph.svg)](https://developer.ibm.com/recipes/tutorials/category/internet-of-things-iot/){:new_window} that are available on IBM.com.


## Step 3: Connecting devices through the gateway
{: #gateway_devices}

Devices that are connected to the gateway are automatically added {{site.data.keyword.iot_short_notm}} when the gateway publishes messages from the device. Both the device type and device itself are automatically created when the gateway publishes a message for a device type and device ID combination that does not already exist.

For information about device auto registration and publishing and receiving data for connected devices, see [MQTT connectivity for gateways](mqtt.html).


When a device is successfully connected to your gateway, it displays on the dashboard of your {{site.data.keyword.iot_short_notm}} organization.

Refer to recipe [Connecting Raspberry Pi as a Gateway to Watson IoT ![External link icon](../../../icons/launch-glyph.svg)](https://developer.ibm.com/recipes/tutorials/connecting-raspberry-pi-as-a-gateway-to-watson-iot-using-node-red/){:new_window} for detailed flow and description.

**Note:** In the {{site.data.keyword.iot_short_notm}} dashboard, devices and gateways that are connected directly to the {{site.data.keyword.iot_short_notm}} display a status icon to indicate that they are connected. The dashboard displays devices that are connected indirectly through a gateway as disconnected as it does not have any knowledge of a devices connectivity to the gateway.


## Installing the Edge Analytics Agent
{: #edge}

The Edge Analytics Agent (EAA) is a is a software component built on top of a streaming engine which is optimized for edge processing to carry out edge analytics operations on a gateway by uploading and managing edge analytics rules from the {{site.data.keyword.iot_short_notm}} dashboard. For more information about edge analytics, see [Edge Analytics](../edge_analytics.html).

### Installing EAA
{: #eaa_install}

To install EAA on your gateway:
1. In the {{site.data.keyword.iot_short}} dashboard, go to **Rules**.
2. Click **Download Edge Agent** to go to the [IBM Edge Analytics community ![External link icon](../../../icons/launch-glyph.svg)](https://www.ibm.com/developerworks/community/groups/service/html/communitystart?communityUuid=3df173af-0c21-4b9c-9fd1-e8e5561ef460&ftHelpTip=true){:new_window}.
3. Navigate to the **Files** section, and download the appropriate compressed directories for your type of gateway.  
The Edge Analytics solution is available as an SDK for devices that support Java or as a DSLink for Cisco gateway devices.
4. For information about how to install and configure the EAA software component on your gateway, see the following information:
 - SDK  
 See the PDF and readme file and the video links that are available in the community.  
 [Edge Recipe for SDK - Getting Started (SDK) ![External link icon](../../../icons/launch-glyph.svg)](https://developer.ibm.com/recipes/tutorials/getting-started-with-the-ibm-edge-analytics-sdk-in-watson-iot-platform/){:new_window} recipe.
 - DSLink  
 [Getting started with Edge Analytics in Watson IoT Platform ![External link icon](../../../icons/launch-glyph.svg)](https://developer.ibm.com/recipes/?post_type=pnext_tutorial&p=19472){:new_window} recipe.

### EAA configuration settings
{: #eaa_configuration}

You can use the EAA config.properties file to set basic software configuration parameters.

To update EAA configuration:
1. On the gateway system where the EAA is running, locate the EAA config.properties file.  
For example:
`../dglux-server/dslinks/ibm-watson-iot-edge-analytics-dslink-java-0.0.1/config.properties`
2. Before you begin editing the settings, make a backup copy of the file.
3. Open the config.properties file for editing.
4. Edit the configuration parameters for your environment:
 <dl>
 <dt>DataDirectSendEnable</dt>
 <dd>BOOLEAN (true|false)</br>
 TRUE (default) - Send all data to {{site.data.keyword.iot_short_notm}}.</br>
 FALSE - Only send data to {{site.data.keyword.iot_short_notm}} if rules are set on the engine. </dd>
 <dt>MonitorInterval</dt>
 <dd>INTEGER (milliseconds)</br>
 The time in milliseconds before a new monitoring message is sent to {{site.data.keyword.iot_short_notm}}. </br>
 Set a small value to report monitor metrics more often. Set a large value to have more detailed monitoring information on {{site.data.keyword.iot_short_notm}}. </br>
 DEFAULT: 60000    </br>
 RECOMMENDED RANGE: [1000, 360000]</dd>
 <dt>MonitorLogDesample</dt>
 <dd>INTEGER  </br>
 De-sampling ratio between the number of monitoring messages sent to {{site.data.keyword.iot_short_notm}} compared to the messages entered in the local log. For example, if `MonitorLogDesample` is set to 10, only one local log entry is written for every ten messages that are sent to {{site.data.keyword.iot_short_notm}}. </br>A large number keeps the local log small. A small number provides a more detailed local log.</br>
 DEFAULT: 10</br>
 RECOMMENDED RANGE: [1, 100]</dd>
 <dt>MemoryAlertThreshold</dt>
 <dd>INTEGER (Megabytes)</br>
 The free JVM heap memory threshold at which a memory warning log message is sent to the {{site.data.keyword.iot_short_notm}} diagnostics log. The alert is driven by the monitoring. </br>A small value reduces the number of alert messages sent to  {{site.data.keyword.iot_short_notm}}. A large value gives you an earlier warning if the EAA server is running into memory issues.</br>**Tip:** You can use [cloud analytics](../cloud_analytics.html) rules to configure alert actions such as email notifications to alert you of memory issues. For information about the available properties that you can use to build rules, see [Edge Analytics Agent diagnostic metrics](../edge_analytics.html#eaa_metrics).</br>
  DEFAULT: 10</br>
 RECOMMENDED RANGE: [10 or 5% of the total memory, 200]</dd>
 </dl>
5. Save the edited file, and then restart EAA.

Sample EAA config.properties file
```
#######################################################################
# Engine Parameters
#######################################################################
# DataDirectSendEnable
#                    - BOOLEAN(true|false) Set to true to forward all
#                      the data; Set to false to disable data direct
#                      send to IOTP when there is no rule set in the
#                      engine.
#                      DEFAULT: true
#######################################################################
DataDirectSendEnable=true

#######################################################################
# Monitoring Parameters
#######################################################################
# MonitorInterval    - INTEGER Time interval in milliseconds before a  
#                      new monitoring message is generated. Set it to a
#                      small value to report the monitor metrics more
#                      frequently. Set it to a big value to have more
#                      detailed monitoring information on IoTP.
#                      DEFAULT: 60000    RECOMMEND: [1000, 360000]
# MonitorLogDesample - INTEGER The de-sampling ratio of the number of
#                      monitoring messages sent to IOTP vs. local log,
#                      i.e. number of monitoring messages N where
#                      EAA would output only one to the Info log for
#                      every N messages. Set it big to keep the size
#                      of the log small. Set it small to have detailed
#                      monitoring information in local log.
#                      DEFAULT: 10       RECOMMEND: [1, 100]
# MemoryAlertThreshold
#                    - INTEGER the free JVM heap memory in megabyte under
#                      which a log message would be generated and send to
#                      IOTP diagnosis log. The alert is driven by the
#                      monitoring. Set it small to eliminate unnecessary
#                      alert message on IoTP. Set it big to receive early
#                      alert when the system is likely to crash. Set to
#                      Min(Max(10MB, 5% of the total memory), 200MB) is
#                      recommended.
#                      DEFAULT: 10       RECOMMEND: [10, 200]
#######################################################################

MonitorInterval=60000
MonitorLogDesample=10
MemoryAlertThreshold=10
```

---

copyright:
  years: 2016, 2017
lastupdated: "2017-02-02"
---

{:new_window: target="\_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}
{:pre: .pre}

# 配置憑證
{: #set_up_certificates}

憑證是用於裝置鑑別，或取代預設 {{site.data.keyword.iot_full}} 伺服器憑證以進行 MQTT 傳訊。沒有有效簽章憑證的任何裝置，都會被拒絕存取，且無法與伺服器通訊。

為了配置裝置的憑證和伺服器存取權，系統操作員會登錄關聯的憑證管理中心 (CA) 憑證，以及選擇性地將訊息伺服器憑證登錄至 {{site.data.keyword.iot_short_notm}} 平台。

## 憑證需求
{: #cert_reqs}

### CA 憑證
CA 憑證可讓組織將裝置上的用戶端憑證辨識為受信任，讓裝置可以連接至伺服器。CA 憑證可以使用憑證撤銷清冊 (CRL)。將 CA 新增至平台時，必須可以使用 CRL，否則將拒絕 CA 憑證。

如果您新增 CA 憑證，或取代傳訊伺服器憑證，則所有裝置都必須使用支援「伺服器名稱指示 (SNI)」的 MQTT 用戶端來連接，因此，伺服器可以使用適當的 CA 來鑑別裝置。

如果您新增 CA 憑證，但未啟用「風險與安全管理」附加程式，則所有裝置都是使用「使用記號和用戶端憑證鑑別的傳輸層安全 (TLS)」連線原則進行連線。如果您已啟用「風險與安全管理」附加程式，則可以配置不同連線原則。如需如何配置連線安全原則的相關資訊，請參閱[配置安全原則](set_up_policies.html)。

### 用戶端或裝置憑證
個別用戶端或裝置憑證會保留在裝置上，而且不會上傳至平台。用來簽署所有裝置憑證的 CA 簽署憑證是您上傳至平台的唯一憑證。如果您使用的是自簽伺服器憑證，則必須上傳用來簽署用戶端憑證 (cert.pem) 的主要及中繼 CA (ca.pem)。

使用 CA 憑證所簽署的個別裝置憑證必須輸入裝置 ID 作為憑證中的「通用名稱 (CN)」或 SubjectAltName。*CN* 欄位的格式為 'CN=d:devtype:devid'。SubjectAltName 欄位的格式為 'SubjectAltName=email:d:devtype:devid'，其中 'devtype' 是裝置的「裝置類型」，而 'devid' 是裝置的「用戶端 ID」。

## 登錄憑證管理中心 (CA) 憑證來進行裝置鑑別
{: #reg_ca_cert}

1. 登入 {{site.data.keyword.iot_short_notm}}，並導覽至**一般設定**。
2. 在**安全**區段的 **CA 憑證**下，按一下**新增憑證**。
3. 瀏覽並選取要上傳的憑證檔案，或將檔案拖放在**新增憑證**視窗中。該檔案中只能有一個憑證，且憑證日期必須有效。僅接受 .pem 或 .der 格式的憑證。您可以預覽所選取檔案中的憑證資訊。
4. 輸入憑證檔案的說明。
5. 確認已選取正確的檔案，然後按一下**儲存**。所選取的憑證會列在表格中，且預設為作用中。

## 登錄傳訊伺服器憑證
{: #reg_msg_cert}

平台附有預設伺服器憑證。您可以使用預設憑證，或是從組織上傳憑證。如果您還沒有憑證可使用，則可以建立要求來取得新憑證。接收新憑證之後，您必須加以簽署，然後上傳回平台。

若要使用預設憑證，或已上傳的另一個憑證，請從**傳訊伺服器憑證**之表格的**預設傳訊伺服器憑證**下拉清單中，選取您要使用的憑證。

**附註：**平台儀表板頁面可能會執行與傳訊伺服器的內部連線來擷取裝置資訊。設定組織的自簽伺服器憑證時，儀表板使用者必須在其瀏覽器中將伺服器憑證新增為授信憑證以避免連線問題，因為瀏覽器預設不會將傳訊伺服器辨識為授信伺服器。

### 從組織上傳憑證
{: #upload_cert}
1. 在**一般設定**的**安全**區段中，按一下**傳訊伺服器憑證**下的**新增憑證**。
2. 瀏覽並選取要上傳的憑證檔案，或將檔案拖放在**新增憑證**視窗中。
3. 瀏覽並選取要上傳的私密金鑰檔案，或將檔案拖放在**新增憑證**視窗中。  
4. 輸入私密金鑰的通行詞組（如果私密金鑰有使用通行詞組來加密）。
5. 確認已選取正確的檔案，然後按一下**儲存**。
6. 從**預設傳訊伺服器憑證**下拉清單中，選取新上傳的憑證。所選取的憑證會在表格中列為作用中憑證。

### 要求新憑證
{: #request_cert}

如果您要使用新的傳訊伺服器憑證，則可以產生「憑證簽署要求 (CSR)」來要求新憑證。

 1. 在**一般設定**的**安全**區段中，按一下**傳訊伺服器憑證**下的**產生 CSR**。
 2. 輸入詳細資料來為您的伺服器要求 CSR，然後按一下**產生**。CSR 即顯示在表格中。
 3. 下載要求，並將其提交至憑證管理中心進行簽署。
 4. 取得憑證之後，您可以依照[從組織上傳憑證](#upload_cert)中的步驟將其上傳。上傳憑證之後，表格中的 CSR 就會被上傳的憑證所取代。

---

copyright:
  years: 2015,2016

---

{:shortdesc: .shortdesc}

# 创建规则和响应警报
{: #rules}

使用分析规则可为设备设置警报和通知。例如，可以创建一条规则，用于在设备的温度传感器显示异常高温时，向“设备”仪表板添加警报并向管理员发送电子邮件。
{: shortdesc}

您可以使用包含条件的规则，这些条件将数据点或上下文参数（例如，资产映射）与静态值、其他数据点或上下文参数进行比较。

>**注：**使用 {{site.data.keyword.iotrtinsights_short}} 的免费套餐实例时，所有规则都会在一小时后自动停用。您可以手动重新激活规则。要使规则持续处于活动状态，可以升级到付费套餐。

要为设备创建规则，请执行以下步骤：
1. 在 {{site.data.keyword.iotrtinsights_short}} 控制台中，转至**分析 > 规则**。
2. 单击**添加新规则**，为规则命名，提供描述，并为规则选择消息模式，然后单击**下一步**。  
3. 单击**确定**以创建新规则。
3. **可选：**为规则选择警报优先级。
优先级用于对“警报”面板中显示的警报分类。缺省优先级为“低”。
3. 要设置规则逻辑，请添加一个或多个 IF 条件以用作规则的触发器。
可以通过并列行的方式添加条件以将其应用为 OR 条件，也可以通过顺序列的方式添加条件以将其应用为 AND 条件。
**提示：**要熟悉设备返回的典型值，请转至**设备 > 浏览设备**，然后单击设备以查看显示的实时数据。
**重要信息：**要触发用于比较两个数据点的条件，或者触发以顺序方式组合的两个或更多数据点条件，触发数据必须包含在同一消息中。如果数据是在多个消息中收到的，那么不会触发该条件或顺序条件。  
> **示例：**   
如果参数值大于指定值，那么可使用简单规则来触发警报。  
例如：条件 = `ax>5`  
如果映射到特定资产的设备的参数值超过特定值，那么可使用更复杂的规则来触发警报。  
例如：条件 = `ax>5 AND asset.assetnum==5001`   
有关详细步骤，请参阅[示例：使用消息模式和上下文参数条件创建复杂规则](#complex "示例：使用消息模式和上下文参数条件创建复杂规则")。  
4. 为规则配置有条件触发要求。
要控制一段时间内为规则触发的警报数，可以为规则配置有条件触发要求。
**重要信息：**有条件触发将作用于该规则中的任何条件。例如，如果某个规则设置了 5 个不同的并行 (OR) 条件，那么为 true 的每个条件都会计入有条件触发器计数。
要为规则设置有条件触发，请执行以下步骤：
 1. 在规则编辑器中，单击链接**每次符合条件时触发**以打开条件对话框。
 2. 选择并配置要用于规则的有条件触发器。
 <ul>
 <li>每次满足条件时触发</li>
 <li>在 M *时间单位*内条件满足 N 次时触发</li>
 </ul>  
有关有条件触发器的更详细描述，请参阅[有条件触发](#conditional "有条件触发概述")。
5. 创建或选择在满足规则条件时执行的一个或多个操作。
有关操作的更多信息，请参阅[创建操作](actions.html#shared "创建操作")。   
 > 例如：操作可以为发送电子邮件。有关不同操作类型的信息，请参阅[操作类型](actions.html "操作类型")。
6. 对规则满意后，单击**保存**。
7. 在“规则”页面上，单击 ![“配置”图标。](images/gear.png "“配置”图标")，然后选择**激活**以激活规则。

您的规则已处于活动状态。如果满足规则的条件，将向**仪表板 > 概述**仪表板添加警报，并执行任何规则操作。

## 有条件触发
{: #conditional}

要控制一段时间内为规则触发的警报数，可以为规则配置有条件触发要求。

根据消息频率和规则条件，一旦满足触发条件，规则可能会触发许多次。例如，如果条件为 `temp >= 90`，并且温度上升并稳定在 91，那么现在对于每条入局消息都会触发该规则。根据设备消息的频率和规则设置为执行的操作，这可能会导致一些问题，例如迅速填满您的电子邮件收件箱，或者使 Twitter 订阅源收到海量消息，而除了第一条消息之外，这些消息并没有提供任何额外的价值。

**重要信息：**有条件触发将作用于该规则中的任何条件。例如，如果某个规则设置了 5 个不同的并行 (OR) 条件，那么为 true 的每个条件都会计入有条件触发器计数。


条件 | 描述
------------- | -------------
每次满足条件时触发 | 每次满足规则条件时，就触发规则。
在 M *天/小时/分钟/定制*内条件满足 N 次时触发 | 在所选时间间隔内，条件满足 N 次时触发规则，然后在所配置的时间段之后才有可能再次触发规则。</br>示例：有条件触发要求 = `30 分钟内条件满足 4 次时只触发一次`。设备每 5 分钟发送一条新消息。在中午，温度初次超过 90 度，这满足了条件。有条件触发器计数器会启动，但还不会触发规则。在 15 分钟后，又收到三条消息指示 `temp > 90` 时，会触发规则。在接下来的 15 分钟内，不管温度高低，都不会再触发规则。

## 示例：使用消息模式和上下文参数条件创建复杂规则
{: #complex}

要创建更复杂的规则（对于映射到资产编号 5001 的任何“IoT 手机”设备，当 ax 参数超过值 5 时，在“警报”仪表板中创建警报），请执行以下步骤：
1. 转至**设备 > 管理资产映射**，然后将至少一个“IoT 手机”设备映射到资产编号为 5001 的资产。
有关详细步骤，请参阅[管理资产](assets.html "管理资产")。
2. 转至**分析**，然后单击**添加新规则**。
3. 为规则提供描述性名称和描述，然后通过选择为“IoT 手机”设备类型创建的消息模式，指定要应用该规则的设备类型。
4. 单击**确定**以创建新规则。
<!-- 5. Click ![Add icon.](images/rules_plus.png "Add icon") to add an initial condition. -->
6. 单击“新建条件”磁贴，然后编辑初始条件。
 1. 选择**数据点**作为要比较的源操作数。
 2. 选择 **ax** 数据点。
 3. 选择 **>** 运算符，使得在第一个操作数的值大于第二个操作数的值时，条件为 true。
 3. 选择**静态值**作为要比较的目标操作数。
 4. 输入值 `5` 以将 ax 数据点与其进行比较。
 5.  单击**确定**以添加条件。
5. 要添加 AND 条件，请单击第一个条件右侧的 ![“添加”图标。](images/rules_plus.png "“添加”图标")。
6. 单击“新建条件”磁贴，然后编辑条件。
  1. 选择**上下文**作为要比较的源操作数。
  2. 在“上下文参数”菜单中，单击**资产**上下文模式前面的三角形，以展开资产上下文参数的列表。
  3. 选择 **ASSETNUM** 上下文模式参数。
  3. 选择 **==** 运算符，使得在第一个操作数的值等于第二个操作数的值时，条件为 true。
  3. 选择**静态值**作为要比较的目标操作数。
  4. 输入 `5001` 作为要将 **ASSETNUM** 上下文模式参数与其进行比较的值。
  5.  单击**确定**以创建条件。
7. 使用缺省有条件触发器：`每次满足条件时触发`。
7. 创建或选择一个或多个操作。
7. 保存新规则。
7. 在“规则”页面上的“新建规则”磁贴中，单击 ![“配置”图标。](images/gear.png "“配置”图标")，然后选择**激活**以激活规则。

## 示例：创建基于资产的规则
{: #asset_rules}

成功将设备映射到资产后，可以创建使用资产详细信息的规则。将设备映射到资产并创建同时包含数据点和资产信息的规则是非常有用的工具。

在以下示例中，我们将使用资产来跟踪公司手机。已创建两个资产并将其映射到手机。资产 5001 映射到 PURCHASEPRICE < 100 的手机，资产 5002 映射到 PURCHASEPRICE >=100 的手机。每个示例的设备数据触发条件为 `d.ax>5`，在这个简化的示例中，此条件对应于手机突然加速，例如手机掉落。

现在，可以设置两个简单规则，用于在映射到资产 5001 的手机掉落时通知我们。设置规则来跟踪未映射到 5001 的手机的掉落也同样简单。这可以是 5002 中的任何手机，或者根本未映射到资产的任何手机。

示例 | 规则
------------- | -------------
仅当设备属于资产 5001 时触发规则 | IF `d.ax>5` AND  `asset.assetnum==5001` THEN ...
仅当设备不属于资产 5001 时触发规则 | IF `d.ax>5` AND  `asset.assetnum!=5001` THEN ...

您还可以设置对于具有特定 PURCHASEPRICE 的手机触发的规则。  

示例 | 规则
------------- | -------------
仅当手机售价低于 100 时触发规则 | IF `d.ax>5` AND  `asset.purchaseprice<100` THEN ...
仅当手机售价高于 100 时触发规则 | IF `d.ax>5` AND  `asset.purchaseprice>=100` THEN ...

最后，可以组合这些规则以用于更复杂的行为。

示例 | 规则
------------- | -------------
仅当手机属于资产 5001（售价低于 100）但售价高于 75 时触发规则 | IF `d.ax>5` AND `asset.assetnum==5001` AND  `asset.purchaseprice>75` THEN ...
仅当手机属于资产 5002（售价高于 100）但售价低于 200 时触发规则 | IF `d.ax>5`  AND `asset.assetnum==5002` AND  `asset.purchaseprice<200` THEN ...
